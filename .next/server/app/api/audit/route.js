(()=>{var e={};e.id=419,e.ids=[419],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},7779:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>R,routeModule:()=>f,serverHooks:()=>E,workAsyncStorage:()=>w,workUnitAsyncStorage:()=>x});var a={};r.r(a),r.d(a,{GET:()=>h});var n=r(96559),i=r(48088),o=r(37719),s=r(32190),u=r(35345),c=r(99708),d=r(29039),l=r(29021),p=r.n(l),g=r(33873);let m=r.n(g)().join(process.cwd(),process.env.AUDIT_LOG_PATH||"logs/audit-log.json");async function h(e){try{if(!await (0,c.qc)())return u.I.forbidden("Admin privileges required to access audit logs");let t=new URL(e.url),r=Number(t.searchParams.get("limit"))||100,a=Math.min(Math.max(r,1),500),n=Math.max(Number(t.searchParams.get("page"))||1,1),i=t.searchParams.get("action"),o=t.searchParams.get("user"),l=t.searchParams.get("startDate"),g=t.searchParams.get("endDate");if(await (0,d.LR)(await (0,d.hn)("ACCESS_AUDIT_LOGS",{limit:a,page:n,action:i,user:o,startDate:l,endDate:g})),!p().existsSync(m))return s.NextResponse.json({logs:[],total:0,page:n,limit:a});if((await p().promises.stat(m)).size>0xa00000)return u.I.internalServerError("Audit log file is too large to process");let h=[],f=await p().promises.readFile(m,"utf-8"),w=JSON.parse(f);if(i&&(w=w.filter(e=>e.action===i)),o&&(w=w.filter(e=>e.user===o)),l){let e=new Date(l).getTime();w=w.filter(t=>new Date(t.timestamp).getTime()>=e)}if(g){let e=new Date(g).getTime();w=w.filter(t=>new Date(t.timestamp).getTime()<=e)}let x=w.length,E=(n-1)*a,R=E+a;return h=w.slice(E,R),s.NextResponse.json({logs:h,total:x,page:n,limit:a,totalPages:Math.ceil(x/a)})}catch(r){let e;console.error("Error retrieving audit logs:",r);let t=(e=r.message,[/password=\S+/gi,/token=\S+/gi,/apikey=\S+/gi,/secret=\S+/gi,/authorization=\S+/gi,/at\s+.*\(.*\)/gi,/\/[\w\/\.-]+/gi].forEach(t=>{e=e.replace(t,"[REDACTED]")}),e);return await (0,d.LR)(await (0,d.hn)("ACCESS_AUDIT_LOGS_FAILURE",{error:t})),u.I.internalServerError("Failed to retrieve audit logs")}}let f=new n.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/audit/route",pathname:"/api/audit",filename:"route",bundlePath:"app/api/audit/route"},resolvedPagePath:"C:\\Dev\\PhoenixVC\\content_creation\\app\\api\\audit\\route.ts",nextConfigOutput:"",userland:a}),{workAsyncStorage:w,workUnitAsyncStorage:x,serverHooks:E}=f;function R(){return(0,o.patchFetch)({workAsyncStorage:w,workUnitAsyncStorage:x})}},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},29021:e=>{"use strict";e.exports=require("fs")},29039:(e,t,r)=>{"use strict";r.d(t,{LR:()=>i,hn:()=>n});var a=r(44999);async function n(e,t,r,n){let i=await (0,a.b3)(),o=i.get("x-invoke-path")||"unknown",s=i.get("x-http-method")||"unknown";return{action:e,user:i.get("x-user-id")||"anonymous",timestamp:new Date().toISOString(),path:o,method:s,body:t?function e(t){if(!t)return t;let r=["password","token","apiKey","secret","authorization"],a={...t};for(let[t,n]of Object.entries(a)){let i=t.toLowerCase();if(r.some(e=>i.includes(e))){a[t]="[REDACTED]";continue}"object"==typeof n&&null!==n&&(a[t]=e(n))}return a}(t):void 0,result:r,statusCode:n}}async function i(e){try{await fetch("/api/internal/audit-log",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})}catch(t){console.error("[AUDIT SERVICE ERROR]",t),console.log("[AUDIT FALLBACK]",JSON.stringify(e))}}},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:e=>{"use strict";e.exports=require("path")},35345:(e,t,r)=>{"use strict";r.d(t,{I:()=>i,Uj:()=>o});var a=r(32190);function n(e,t=500,r,i){let o={message:e};return r&&(o.details=r),i&&(o.code=i),a.NextResponse.json(o,{status:t})}let i={badRequest:(e="Bad request",t)=>n(e,400,t,"BAD_REQUEST"),unauthorized:(e="Unauthorized",t)=>n(e,401,t,"UNAUTHORIZED"),forbidden:(e="Forbidden",t)=>n(e,403,t,"FORBIDDEN"),notFound:(e="Not found",t)=>n(e,404,t,"NOT_FOUND"),methodNotAllowed:(e="Method not allowed",t)=>n(e,405,t,"METHOD_NOT_ALLOWED"),conflict:(e="Conflict",t)=>n(e,409,t,"CONFLICT"),internalServerError:(e="Internal server error",t)=>n(e,500,t,"INTERNAL_SERVER_ERROR")};function o(e){return async(t,r)=>{try{return await e(t,r)}catch(e){if(console.error("API Error:",{error:e,timestamp:new Date().toISOString(),url:t?.url||"unknown",method:t?.method||"unknown"}),"ValidationError"===e.name)return i.badRequest("Validation error",e.details);return i.internalServerError(e.message||"An unexpected error occurred",e.cause)}}}},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},78335:()=>{},96487:()=>{},99708:(e,t,r)=>{"use strict";r.d(t,{qc:()=>i,wR:()=>n});var a=r(44999);async function n(){return!!(await (0,a.b3)()).get("x-user-id")}async function i(){return"admin"===(await (0,a.b3)()).get("x-user-role")}r(32190)}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[360],()=>r(7779));module.exports=a})();